# AI Service CI/CD
# NOTE: Railway Native Git Integration handles deployment (no token needed)

name: AI Service CI/CD

on:
  push:
    branches: [main]
    paths:
      - 'ai-service/**'
      - 'data/**'
      - 'pipeline/**'
      - 'tests/**'
  pull_request:
    branches: [main]
    paths:
      - 'ai-service/**'
      - 'data/**'
      - 'tests/**'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          cd ai-service
          pip install -r requirements-test.txt
      
      - name: Run unit tests
        run: |
          cd ai-service
          python -m pytest ../tests/ -v --tb=short

  # NOTE: Deploy job DISABLED - Railway Native Git Integration auto-deploys on push
  # deploy:
  #   runs-on: ubuntu-latest
  #   needs: test
  #   if: github.ref == 'refs/heads/main'
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - name: Install Railway CLI
  #       run: npm install -g @railway/cli
  #
  #     - name: Deploy to Railway
  #       run: railway up --service ai-service --detach
  #       env:
  #         RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
